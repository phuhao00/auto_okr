# Git 提交记录报告生成器

一个基于 Git 提交记录自动生成日报和周报的 Golang 工具，支持命令行和 Web 界面两种使用方式。

## 功能特性

- 📅 **自动生成日报和周报**：基于 Git 提交记录自动生成工作报告
- 🌐 **Web 界面**：现代化的 Next.js 前端界面，支持在线生成和预览报告
- 🖥️ **命令行工具**：传统的 CLI 工具，适合脚本化和自动化场景
- 🔌 **HTTP API**：RESTful API 接口，支持第三方集成
- 👤 **多用户支持**：可指定特定作者或使用当前 Git 用户
- 📊 **详细统计信息**：包含提交次数、代码行数、文件类型分布等
- 🏷️ **智能分类**：自动将提交按功能开发、Bug修复、重构等类别分组
- 🎨 **自定义模板**：支持使用自定义模板定制报告格式
- 💾 **灵活输出**：支持控制台输出、文件保存或在线预览

## 安装

### 后端服务

```bash
# 克隆项目
git clone <repository-url>
cd git-report-generator

# 安装 Go 依赖
go mod tidy

# 编译
go build -o git-report.exe
```

### 前端界面（可选）

```bash
# 进入前端目录
cd frontend

# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

## 使用方法

### Web 界面使用

1. **启动后端服务**
```bash
# 启动 HTTP 服务器（默认端口 8080）
./git-report.exe -server
```

2. **启动前端界面**
```bash
# 在另一个终端中启动前端（默认端口 3000）
cd frontend
npm run dev
```

3. **访问 Web 界面**
   - 打开浏览器访问 `http://localhost:3000`
   - 输入 Git 仓库路径
   - 选择报告类型和日期
   - 在线生成和预览报告
   - 支持下载 Markdown 格式报告

### API 接口

#### 生成报告
```bash
POST /api/generate-report
Content-Type: application/json

{
  "repo_path": "/path/to/repo",
  "report_type": "daily",
  "date": "2024-01-15",
  "author": "张三"
}
```

#### 健康检查
```bash
GET /api/health
```

### 命令行使用

#### 基本用法

```bash
# 生成今日日报
./git-report.exe

# 生成指定日期的日报
./git-report.exe -date 2024-01-15

# 生成本周周报
./git-report.exe -type weekly

# 生成指定作者的报告
./git-report.exe -author "张三"

# 指定Git仓库路径
./git-report.exe -repo /path/to/your/repo

# 保存报告到文件
./git-report.exe -output daily-report.md

# 使用自定义模板
./git-report.exe -template custom-template.tmpl
```

### 命令行参数

| 参数 | 说明 | 默认值 | 示例 |
|------|------|--------|---------|
| `-server` | 启动 HTTP 服务器模式 | false | `-server` |
| `-type` | 报告类型：daily, weekly | daily | `-type weekly` |
| `-date` | 指定日期 (YYYY-MM-DD) | 今天 | `-date 2024-01-15` |
| `-repo` | Git仓库路径 | 当前目录 | `-repo /path/to/repo` |
| `-author` | 指定作者 | 当前Git用户 | `-author "张三"` |
| `-output` | 输出文件路径 | 控制台输出 | `-output report.md` |
| `-template` | 自定义模板文件 | 内置模板 | `-template my-template.tmpl` |

## 报告内容

### 日报包含
- 📊 当日统计信息（提交次数、修改文件数、代码行数）
- 🔥 主要修改文件列表
- 📁 文件类型分布
- 📝 按类别分组的详细提交记录

### 周报包含
- 📊 本周统计信息
- 📅 每日提交分布
- 🔥 主要修改文件列表
- 📁 文件类型分布
- 📝 按类别分组的工作内容
- 💡 本周工作总结

## 提交分类规则

工具会根据提交信息自动将提交分类为：

- **功能开发**：包含 feat, feature, add, 新增, 功能 等关键词
- **Bug修复**：包含 fix, bug, 修复, 修正 等关键词
- **代码重构**：包含 refactor, 重构 等关键词
- **文档更新**：包含 doc, readme, 文档 等关键词
- **测试相关**：包含 test, 测试 等关键词
- **配置修改**：包含 config, 配置 等关键词
- **其他**：不符合以上分类的提交

## 自定义模板

可以创建自定义模板文件来定制报告格式。模板使用 Go 的 `text/template` 语法。

### 可用变量

- `.Type`：报告类型（daily/weekly）
- `.Date`：报告日期
- `.Period`：时间范围描述
- `.Author`：作者名称
- `.RepoInfo`：仓库信息（name, branch, url）
- `.Commits`：提交记录列表
- `.Summary`：统计摘要
- `.Categories`：按类别分组的提交
- `.GeneratedAt`：生成时间

### 可用函数

- `formatTime`：格式化时间
- `formatDate`：格式化日期
- `formatShortHash`：格式化短哈希
- `join`：连接字符串数组
- `sortedKeys`：获取排序后的键
- `sortedFileTypes`：获取排序后的文件类型

### 示例模板

```go
# {{.Author}} 的工作{{if eq .Type "daily"}}日报{{else}}周报{{end}}

**时间：** {{.Period}}
**仓库：** {{.RepoInfo.name}}

## 统计信息
- 提交次数：{{.Summary.TotalCommits}}
- 修改文件：{{.Summary.TotalFiles}}
- 代码变更：+{{.Summary.TotalAdditions}} -{{.Summary.TotalDeletions}}

{{range sortedKeys .Categories}}
### {{.}}
{{range index $.Categories .}}
- {{.Message}} ({{formatShortHash .Hash}})
{{end}}
{{end}}
```

## 项目架构

```
┌─────────────────────────────────────────────────────────────────┐
│                           用户界面层                              │
├─────────────────────────────────────────────────────────────────┤
│  Web 浏览器 (http://localhost:3000)                             │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                Next.js 前端                              │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │    │
│  │  │   页面组件   │  │   样式组件   │  │   API 客户端 │      │    │
│  │  │ (page.tsx)  │  │(Tailwind CSS)│  │  (fetch)    │      │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘      │    │
│  └─────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────┘
                                │
                                │ HTTP API 调用
                                │ (POST /api/generate-report)
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                        后端服务层                                 │
├─────────────────────────────────────────────────────────────────┤
│  Go HTTP 服务器 (http://localhost:8080)                         │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                   HTTP 路由层                            │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │    │
│  │  │   路由处理   │  │   CORS 中间件│  │   请求验证   │      │    │
│  │  │(Gorilla Mux)│  │   (rs/cors)  │  │             │      │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘      │    │
│  └─────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                   业务逻辑层                              │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │    │
│  │  │  报告生成器  │  │  模板渲染器  │  │   Git 操作   │      │    │
│  │  │ (report.go) │  │(renderer.go)│  │  (git.go)   │      │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘      │    │
│  └─────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────┘
                                │
                                │ Git 命令调用
                                │ (git log, git show)
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                        数据源层                                   │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                   Git 仓库                              │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │    │
│  │  │  提交历史    │  │   分支信息   │  │   文件变更   │      │    │
│  │  │ (.git/logs) │  │ (.git/refs) │  │             │      │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘      │    │
│  └─────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────┘
```

### 架构说明

1. **用户界面层**：基于 Next.js 的现代化 Web 界面，提供直观的用户交互
2. **后端服务层**：Go 语言实现的 HTTP API 服务，处理报告生成逻辑
3. **数据源层**：直接读取 Git 仓库数据，获取提交历史和变更信息

### 数据流向

1. 用户在 Web 界面输入仓库路径和报告参数
2. 前端通过 HTTP API 发送请求到后端服务
3. 后端服务调用 Git 命令获取仓库数据
4. 报告生成器处理数据并使用模板渲染
5. 生成的报告返回给前端进行展示和下载

## 技术栈

### 后端
- **Go 1.21+**：主要编程语言
- **Gorilla Mux**：HTTP 路由
- **CORS**：跨域支持
- **Git**：版本控制系统集成

### 前端
- **Next.js 14**：React 框架
- **TypeScript**：类型安全
- **Tailwind CSS**：样式框架
- **Lucide React**：图标库

## 注意事项

1. 确保在 Git 仓库目录中运行，或使用 `-repo` 参数指定仓库路径
2. 确保已配置 Git 用户信息（`git config user.name`）
3. 工具依赖 `git` 命令，请确保 Git 已正确安装并在 PATH 中
4. 周报默认按周一到周日计算
5. Web 界面需要同时启动后端服务器和前端开发服务器
6. 默认端口：后端 8080，前端 3000

## 示例输出

```markdown
# 张三 的工作日报

**日期：** 2024年01月15日
**仓库：** my-project (main分支)
**生成时间：** 2024-01-15 18:30:00

---

## 📊 今日统计

- **提交次数：** 5 次
- **修改文件：** 8 个
- **新增代码：** 156 行
- **删除代码：** 23 行

### 🔥 主要修改文件
- src/main.go (3次)
- README.md (2次)
- config/app.yaml (1次)

### 📁 文件类型分布
- Go: 5
- Markdown: 2
- 配置文件: 1

---

## 📝 详细提交记录

### 功能开发 (3个提交)

**a1b2c3d4** - 2024-01-15 09:30:00
> feat: 添加用户认证功能
> 📁 修改文件: src/auth.go, src/user.go
> 📈 代码变更: +89 -5

...
```

## 开发

### 项目结构
```
├── main.go              # 主程序入口
├── server.go            # HTTP 服务器
├── git.go              # Git 操作
├── report.go           # 报告生成
├── renderer.go         # 模板渲染
├── go.mod              # Go 模块
├── frontend/           # Next.js 前端
│   ├── app/           # App Router 页面
│   ├── package.json   # 前端依赖
│   └── ...            # 其他前端文件
└── templates/         # 报告模板
```

### 构建生产版本

```bash
# 构建后端
go build -ldflags "-s -w" -o git-report

# 构建前端
cd frontend
npm run build
```

## 许可证

MIT License